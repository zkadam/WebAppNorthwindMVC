@*@model IEnumerable<WebAppEka.Models.Products>*@

@model PagedList.IPagedList<WebAppEka.Models.Products>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



@section scripts {
    <script type="text/javascript">
        $("#singleSelectCategoryID").on("change", function () {
            //getting value to apumuuttaja

            $("#singleSelectCategoryID").val();
            console.log(selValue);
            document.getElementById("ProductCategory").value = selValue;
        });


        //tuotten myynti kaavion
        //clickien kuunelleen ja kutsutaan functio joka piirtäö chartin productName parametrin kannssa ZK
        $(function () {
            $(".getProductName").click(function () {
                let productName = $(this).data("productname");
                console.log(productName);
                drawLineChart(productName);

            })
        });

        function drawLineChart(productName) {
            let url = "/Products/_ProductSalesPerDate/?productName=" + productName;
            var jsonData = $.ajax({
                url: url,
                dataType:'json',
            }).done(function (results) {
                console.log(results);
                //split timestamp and data into seperate arrays
                var salesLabels = [], salesData = [];
                for (var i = 0; i < results.length; i++) {
                    salesData.push(results[i].DailySales);
                    salesLabels.push(results[i].OrderDate);
                }
                renderChart(salesData, salesLabels, productName)
            })
        }

        function renderChart(dataValues, labelTexts, productName) {

           
            var ctx = document.getElementById('barcanvas').getContext('2d');
            var barcanvas = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labelTexts,
                    datasets: [{
                        label: 'Daily product sales for ' + productName,
                        data: dataValues,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                           
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                        ],
                          
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                stepSize:100
                            }
                        }]
                    }
                }
            });
            $('#ProductSalesPerDateModal').modal('show');
        }

    </script>


    
     }







@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create", "Prodsupp")
</p>
@using (Html.BeginForm("Index", "Products", FormMethod.Get))
{
<div class="input-group">
    <p class="px-1">@Html.Label("Find by name:")</p>
    <p class="px-1">@Html.TextBox("searchAsiakas", ViewBag.currentFilter1 as string, new { @class = "form-control" })</p>
    <p class="px-1">@Html.Label("Find by Product Category:")</p>
    <p class="px-1">@Html.Hidden("ProductCategory", ViewBag.currentFilter1 as string, new { @id = "ProductCategory", @class = "form-control" })</p>
    <p class="px-1">@Html.DropDownList("CategoryID",null,htmlAttributes:new { @id = "singleSelectCategoryID", @class = "form-control" })</p>




    <p class="px-1"><input type="submit" value="Search" class="form-control" /></p>

</div>



}

<table class="table">
    <tr>
        @*--------------------tyhjä header chart buttonia varten*@
        <th></th>
        <th>
            @Html.ActionLink("Tuotteen nimi", "Index", new { sortOrder = ViewBag.ProductNameSortParm, currentFilter1=ViewBag.currentFilter1, currentProductCategory = ViewBag.currentProductCategory })
        </th>
        @*<th>
            @Html.DisplayNameFor(model => model.ProductName)
        </th>*@
        <th>
            QuantityPerUnit
        </th>
        <th>
            @Html.ActionLink("A-hinta", "Index", new { sortOrder=ViewBag.UnitPriceSortParm, currentFilter1 = ViewBag.currentFilter1, currentProductCategory = ViewBag.currentProductCategory })
        </th>
        @*<th>
            UnitPrice)
        </th>*@
        <th>
            UnitsInStock
        </th>
        <th>
            UnitsOnOrder
        </th>
        <th>
            ReorderLevel
        </th>
        <th>
            Discontinued
        </th>
        <th>
            ImageLink)
        </th>
        <th>
            Categories.CategoryName
        </th>
        <th>Suppliers.CompanyName</th>
        <th></th>
    </tr>

@foreach (var item in Model) {
<tr>

    @*-----------------------button class referenced in jquery,*@ 
    <td><button class="btn-dark getProductName" style="border-radius:4px" data-productname="@item.ProductName"><i class="fas fa-chart-bar"></i></button></td>
    <td>@Html.DisplayFor(modelItem => item.ProductName)</td>
    <td>@Html.DisplayFor(modelItem => item.QuantityPerUnit)</td>
    <td>@Html.DisplayFor(modelItem => item.UnitPrice)</td>
    <td>@Html.DisplayFor(modelItem => item.UnitsInStock)</td>
    <td>@Html.DisplayFor(modelItem => item.UnitsOnOrder)</td>
    <td>@Html.DisplayFor(modelItem => item.ReorderLevel)</td>
    <td>@Html.DisplayFor(modelItem => item.Discontinued)</td>
    <td>@Html.DisplayFor(modelItem => item.ImageLink)</td>
    <td>@Html.DisplayFor(modelItem => item.Categories.CategoryName)</td>
    <td>@Html.DisplayFor(modelItem => item.Suppliers.CompanyName)</td>

    <td>
        @Html.ActionLink("Edit", "Edit", "Prodsupp", new { id = item.ProductID }, null) |
        @Html.ActionLink("Details", "Details", "Prodsupp", new { id = item.ProductID }, null) |
        @Html.ActionLink("Delete", "Delete", "Prodsupp", new { id = item.ProductID }, null) 
</tr>
}

</table>

<br/>
@{ Html.RenderPartial("_ProductSalesPerDate");}
Page@(Model.PageCount <Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
@Html.PagedListPager(Model, page => Url.Action("index", new { page, sortOrder = ViewBag.CurrentSort, currentFilter1 = ViewBag.currentFilter1, currentProductCategory = ViewBag.currentProductCategory})) 